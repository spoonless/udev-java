
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Streams &#8212; documentation Le langage Java 1.0</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Les classes internes" href="classe_interne.html" />
    <link rel="prev" title="Les lambdas" href="les_lambdas.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="streams">
<h1>Streams<a class="headerlink" href="#streams" title="Lien permanent vers ce titre">¶</a></h1>
<p>L’API <em>streams</em> a été introduite avec Java 8 pour permettre la programmation
fonctionnelle. Un <em>stream</em> (flux) est une représentation d’une séquence
sur laquelle il est possible d’appliquer des opérations. Cette API a deux
principales intérêts :</p>
<ol class="arabic simple">
<li>Elle permet d’effectuer les opérations sur une séquence sans utiliser de
structure de boucle. Cela permet de réaliser des traitements complexes tout
en maintenant une bonne lisibilité du code.</li>
<li>Les opérations sur les <em>streams</em> sont réalisées en flux (d’où leur nom) ce qui
limite l’empreinte mémoire nécessaire. Il est même possible de réaliser très
simplement des traitements en parallèle pour tirer partie des possibilités
d’une processeur multi-cœurs ou d’une machine multi-processeurs.</li>
</ol>
<div class="section" id="creation-d-un-stream">
<h2>Création d’un stream<a class="headerlink" href="#creation-d-un-stream" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un <em>stream</em> est représenté par une instance de l’interface générique <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a>.
On peut créer un <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a> en utilisant un objet de type <a class="reference external" href="https://en.wikipedia.org/wiki/Builder_pattern">builder</a></p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">builder</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;World&quot;</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
</pre></div>
</div>
<p>Il existe également des interfaces filles de <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a> pour certains types primitifs :
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/IntStream.html">IntStream</a>, <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/LongStream.html">LongStream</a> et <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/DoubleStream.html">DoubleStream</a>. On peut créer des <em>streams</em> de ces
types soit à partir d’une liste de valeurs soit en donnant les limites d’un intervalle.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">IntStream</span> <span class="n">intStream</span> <span class="o">=</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="mi">579</span><span class="o">);</span>

<span class="n">IntStream</span> <span class="n">rangeIntStream</span> <span class="o">=</span> <span class="n">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1_000_000_000</span><span class="o">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Comme mentionné à la section précédente, un des intérêts des <em>streams</em> vient de
leur nature même de flux. Ainsi dans l’exemple précédent, la création d’un <em>stream</em>
à partir d’un intervalle ne crée pas une valeur pour chaque élément. Ainsi la création
d’un <em>stream</em> sur un intervalle d’un milliard est instantanée et ne prend
presque aucune place en mémoire.</p>
</div>
<p>Il est même possible de créer un <em>stream</em> «&nbsp;infini&nbsp;» dont les valeurs sont calculées
par une lambda.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Un stream commençant à la valeur 1 et qui est représenté par la suite n = n + 1</span>
<span class="n">LongStream</span> <span class="n">longStream</span> <span class="o">=</span> <span class="n">LongStream</span><span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
</pre></div>
</div>
<p>Il est également possible de créer un <em>stream</em> à partir d’un tableau grâce aux méthodes
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Arrays.html#stream-T:A-">Arrays.stream</a> :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">int</span><span class="o">[]</span> <span class="n">tableau</span> <span class="o">=</span> <span class="o">{</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span> <span class="o">};</span>
<span class="n">IntStream</span> <span class="n">tableauStream</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">tableau</span><span class="o">);</span>
</pre></div>
</div>
<p>Les collections peuvent également être utilisées sous la forme d’un <em>stream</em> car
l’interface <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html">Collection</a> définit la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#stream--">Collection.stream</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">liste</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="n">liste</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">);</span>
<span class="n">liste</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;World&quot;</span><span class="o">);</span>

<span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">liste</span><span class="o">.</span><span class="na">stream</span><span class="o">();</span>
</pre></div>
</div>
<p>Le contenu d’un fichier texte peut aussi être parcouru sous la forme d’un <em>stream</em>
de chacune de ses lignes grâce à la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#lines-java.nio.file.Path-">Files.lines</a> :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Path</span> <span class="n">fichier</span> <span class="o">=</span> <span class="n">Paths</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;fichier.txt&quot;</span><span class="o">);</span>
<span class="n">Stream</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">linesStream</span> <span class="o">=</span> <span class="n">Files</span><span class="o">.</span><span class="na">lines</span><span class="o">(</span><span class="n">fichier</span><span class="o">);</span>
</pre></div>
</div>
<p>Ainsi, toutes les opérations qui impliquent une séquence d’éléments peuvent être
traitées sous la forme d’un <em>stream</em>.</p>
<p>Il est possible de réaliser un traitement sur chaque élément du <em>stream</em>
grâce à la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#forEach-java.util.function.Consumer-">Stream.forEach</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Affiche les chiffres de 10 jusqu&#39;à 0</span>
<span class="n">IntStream</span><span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">).</span><span class="na">limit</span><span class="o">(</span><span class="mi">11</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
<p>Un <em>stream</em> est également utilisé pour produire un résultat unique ou une
collection. Dans le premier cas, on dit que l’on réduit, tandis que dans le
second cas, on dit que l’on collecte.</p>
</div>
<div class="section" id="la-reduction">
<h2>La réduction<a class="headerlink" href="#la-reduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>La réduction consiste à obtenir un résultat unique à partir d’un <em>stream</em>.
On peut par exemple compter le nombre d’éléments. Si le <em>stream</em> est composé
de nombres, on peut réaliser une réduction mathématique en calculant la somme,
la moyenne ou en demandant la valeur minimale ou maximale…</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kt">long</span> <span class="n">resultat</span> <span class="o">=</span> <span class="n">LongStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">50</span><span class="o">).</span><span class="na">sum</span><span class="o">();</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">resultat</span><span class="o">);</span>

<span class="n">OptionalDouble</span> <span class="n">moyenne</span> <span class="o">=</span> <span class="n">LongStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">50</span><span class="o">).</span><span class="na">average</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">moyenne</span><span class="o">.</span><span class="na">isPresent</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">moyenne</span><span class="o">.</span><span class="na">getAsDouble</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<p>L’API <em>streams</em> introduit la notion de <em>Optional</em>. Certaines opérations de réduction
peuvent ne pas être possibles. Par exemple, le calcul de la moyenne n’est pas possible
si le <em>stream</em> ne contient aucun élément. La méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/IntStream.html#average--">average</a> qui permet de calculer
la moyenne d’un <em>stream</em> numérique retourne donc un <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/OptionalDouble.html">OptionalDouble</a> qui permet
de représenter soit le résultat, soit le fait qu’il n’y a pas de résultat.
On peut appeler la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/OptionalDouble.html#isPresent--">OptionalDouble.isPresent</a> pour s’assurer qu’il existe
un résultat pour cette réduction.</p>
<p>Pour les streams de tout type, il est possible de réaliser une réduction à partir
d’une lambda grâce à la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/IntStream.html#reduce-int-java.util.function.IntBinaryOperator-">Stream.reduce</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">liste</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&quot;une chaine&quot;</span><span class="o">,</span> <span class="s">&quot;une autre chaine&quot;</span><span class="o">,</span> <span class="s">&quot;encore une chaine&quot;</span><span class="o">);</span>
<span class="n">Optional</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">chaineLaPlusLongue</span> <span class="o">=</span> <span class="n">liste</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">reduce</span><span class="o">((</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">s1</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">s2</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">?</span> <span class="n">s1</span> <span class="o">:</span> <span class="n">s2</span><span class="o">);</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">chaineLaPlusLongue</span><span class="o">.</span><span class="na">get</span><span class="o">());</span> <span class="c1">// &quot;encore une chaine&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="la-collecte">
<h2>La collecte<a class="headerlink" href="#la-collecte" title="Lien permanent vers ce titre">¶</a></h2>
<p>La collecte permet de créer un nouvelle collection à partir d’un stream. Pour
cela, il faut fournir une implémentation de l’interface <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collector.html">Collector</a>. Cette interface
est assez complexe, heureusement la classe outil <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collectors.html">Collectors</a> fournit des méthodes
pour générer une instance de <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collector.html">Collector</a>. Pour réaliser la collecte, il faut
appeler la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#collect-java.util.stream.Collector-">Stream.collect</a>.</p>
<p>On peut ainsi collecter les éléments d’un stream sous la forme d’une <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html">List</a>, d’un
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Set.html">Set</a> ou de tout type de <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html">Collection</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">liste</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&quot;une chaine&quot;</span><span class="o">,</span> <span class="s">&quot;une autre chaine&quot;</span><span class="o">,</span> <span class="s">&quot;encore une chaine&quot;</span><span class="o">);</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">autreListe</span> <span class="o">=</span> <span class="n">liste</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
</pre></div>
</div>
<p>L’exemple précédent peut sembler trivial puisqu’au final, ce code crée un copie
de la liste d’origine. Son intérêt deviendra évident lorsque nous appliquerons
des opérations de filtre ou de mapping sur un <em>stream</em>.</p>
<p>Un <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Collector.html">Collector</a> peut également réaliser un opération de regroupement pour créer
des <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html">Map</a>. Si on dispose de la classe <em>Voiture</em> :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">com.cgi.udev</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Voiture</span> <span class="o">{</span>

  <span class="kd">private</span> <span class="n">String</span> <span class="n">marque</span><span class="o">;</span>

  <span class="kd">public</span> <span class="nf">Voiture</span><span class="o">(</span><span class="n">String</span> <span class="n">marque</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">.</span><span class="na">marque</span> <span class="o">=</span> <span class="n">marque</span><span class="o">;</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMarque</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">marque</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Alors il devient facile de grouper des instances d’une liste de <em>Voiture</em> selon
leur marque.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Voiture</span><span class="o">&gt;</span> <span class="n">liste</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;renault&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;audi&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">));</span>

<span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Voiture</span><span class="o">&gt;&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="n">liste</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">groupingBy</span><span class="o">(</span><span class="n">Voiture</span><span class="o">::</span><span class="n">getMarque</span><span class="o">));</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">).</span><span class="na">size</span><span class="o">());</span> <span class="c1">// 2</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;renault&quot;</span><span class="o">).</span><span class="na">size</span><span class="o">());</span> <span class="c1">// 1</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;audi&quot;</span><span class="o">).</span><span class="na">size</span><span class="o">());</span>    <span class="c1">// 1</span>
</pre></div>
</div>
<p>On peut également créer une chaîne de caractères en joignant les éléments d’un
<em>stream</em> :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="s">&quot;un&quot;</span><span class="o">,</span> <span class="s">&quot;deux&quot;</span><span class="o">,</span> <span class="s">&quot;trois&quot;</span><span class="o">,</span> <span class="s">&quot;quatre&quot;</span><span class="o">,</span> <span class="s">&quot;cinq&quot;</span><span class="o">);</span>
<span class="n">String</span> <span class="n">resultat</span> <span class="o">=</span> <span class="n">list</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">joining</span><span class="o">(</span><span class="s">&quot;, &quot;</span><span class="o">));</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">resultat</span><span class="o">);</span> <span class="c1">// &quot;un, deux, trois, quatre, cinq&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="le-filtrage">
<h2>Le filtrage<a class="headerlink" href="#le-filtrage" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une opération courante sur un <em>stream</em> consiste à appliquer un filtre pour
éliminer une partie de ses éléments. Pour, cela on peut utiliser
la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#filter-java.util.function.Predicate-">Stream.filter</a>.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Voiture</span><span class="o">&gt;</span> <span class="n">liste</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;audi&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">));</span>

<span class="c1">// on construit la liste des voitures qui ne sont pas de marque &quot;citroen&quot;</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Voiture</span><span class="o">&gt;</span> <span class="n">sansCitroen</span> <span class="o">=</span> <span class="n">liste</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                                 <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">v</span> <span class="o">-&gt;</span> <span class="o">!</span><span class="n">v</span><span class="o">.</span><span class="na">getMarque</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">))</span>
                                 <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">sansCitroen</span><span class="o">.</span><span class="na">size</span><span class="o">());</span> <span class="c1">// 1</span>
</pre></div>
</div>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// On affiche les 500 premiers nombres qui ne sont pas divisibles par 7</span>
<span class="n">IntStream</span><span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
         <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span>
         <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
         <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
<p>La méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#filter-java.util.function.Predicate-">Stream.filter</a> peut accepter une lambda qui reçoit en paramètre
un élément du <em>stream</em> et qui retourne un <strong>boolean</strong> (<strong>true</strong> signifie
que l’élément doit être conservé dans le <em>stream</em>). On peut bien évidemment chaîner
les appels à la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#filter-java.util.function.Predicate-">Stream.filter</a> :</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// On affiche les 500 premiers nombres qui ne sont pas divisibles par 7</span>
<span class="c1">// et qui sont impairs</span>
<span class="n">IntStream</span><span class="o">.</span><span class="na">iterate</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
         <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">7</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span>
         <span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">n</span> <span class="o">-&gt;</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span>
         <span class="o">.</span><span class="na">limit</span><span class="o">(</span><span class="mi">500</span><span class="o">)</span>
         <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
</div>
<div class="section" id="le-mapping">
<h2>Le mapping<a class="headerlink" href="#le-mapping" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le mapping est une opération qui permet de transformer la nature du <em>stream</em>
afin de passer d’un type à un autre.</p>
<p>Par exemple, si nous voulons récupérer l’ensemble des marques distinctes d’une
liste de <em>Voiture</em>, nous pouvons utiliser un mapping pour passer d’un <em>stream</em>
de <em>Voiture</em> à un <em>stream</em> de <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html">String</a> (représentant les marques des voitures).</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">List</span><span class="o">&lt;</span><span class="n">Voiture</span><span class="o">&gt;</span> <span class="n">liste</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;audi&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;renault&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;volkswagen&quot;</span><span class="o">),</span>
                                    <span class="k">new</span> <span class="n">Voiture</span><span class="o">(</span><span class="s">&quot;citroen&quot;</span><span class="o">));</span>

<span class="c1">// mapping du stream de voiture en stream de String</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">marques</span> <span class="o">=</span> <span class="n">liste</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
                           <span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">Voiture</span><span class="o">::</span><span class="n">getMarque</span><span class="o">)</span>
                           <span class="o">.</span><span class="na">collect</span><span class="o">(</span><span class="n">Collectors</span><span class="o">.</span><span class="na">toSet</span><span class="o">());</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">marques</span><span class="o">);</span> <span class="c1">// [&quot;audi&quot;, &quot;citroen&quot;, &quot;renault&quot;, &quot;volkswagen&quot;]</span>
</pre></div>
</div>
<p>Pour réaliser un mapping vers un type primitif, il faut utiliser les méthodes
<a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#mapToInt-java.util.function.ToIntFunction-">Stream.mapToInt</a>, <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#mapToLong-java.util.function.ToLongFunction-">Stream.mapToLong</a> ou <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#mapToDouble-java.util.function.ToDoubleFunction-">Stream.mapToDouble</a>. On peut également
utiliser ces méthodes pour convertir un <em>stream</em> contenant un type primitif
vers un <em>stream</em> contenant un autre type primitif.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// Affichage de la racine carré des 100 premiers entiers</span>
<span class="n">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">101</span><span class="o">)</span>
         <span class="o">.</span><span class="na">mapToDouble</span><span class="o">(</span><span class="n">Math</span><span class="o">::</span><span class="n">sqrt</span><span class="o">)</span>
         <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
<p>Pour la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#map-java.util.function.Function-">Stream.map</a>, le type de retour de la lambda ou de la référence de
méthode indique le nouveau type du <em>stream</em>.</p>
</div>
<div class="section" id="le-parallelisme">
<h2>Le parallélisme<a class="headerlink" href="#le-parallelisme" title="Lien permanent vers ce titre">¶</a></h2>
<p>Afin de tirer profit des processeurs multi-cœurs et des machines multi-processeurs,
les opérations sur les <em>streams</em> peuvent être exécutées en parallèle. À partir d’une <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html">Collection</a>, il
suffit d’appeler la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/Collection.html#parallelStream--">Collection.parallelStream</a> ou à partir d’un <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html">Stream</a>,
il suffit d’appeler la méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/util/stream/BaseStream.html#parallel--">BaseStream.parallel</a>.</p>
<p>Un <em>stream</em> en parallèle découpe le flux pour assigner l’exécution à différents
processeurs et recombine ensuite le résultat à la fin. Cela signifie que les
traitements sur le <em>stream</em> ne doivent pas être dépendant de l’ordre d’exécution.</p>
<p>Par exemple, si vous utilisez un <em>stream</em> parallèle pour afficher les 100 premiers
entiers, vous constaterez que la sortie du programme est imprédictible.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// affiche les 100 premiers entiers sur la console en utilisant un stream parallèle.</span>
<span class="c1">// Ceci n&#39;est pas une bonne idée car l&#39;opération d&#39;affichage implique</span>
<span class="c1">// que le stream est parcouru séquentiellement. Or un stream parallèle</span>
<span class="c1">// est réparti sur plusieurs processeurs et donc l&#39;ordre d&#39;exécution</span>
<span class="c1">// n&#39;est pas prédictible</span>
<span class="n">IntStream</span><span class="o">.</span><span class="na">range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">101</span><span class="o">).</span><span class="na">parallel</span><span class="o">().</span><span class="na">forEach</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
</pre></div>
</div>
<p>Par contre, les streams parallèles peuvent être utiles pour des réductions de type
somme puisque le calcul peut être réparti en sommes intermédiaires avant de réaliser
la somme totale.</p>
</div>
<div class="section" id="exercice">
<h2>Exercice<a class="headerlink" href="#exercice" title="Lien permanent vers ce titre">¶</a></h2>
<div class="exercice topic">
<p class="topic-title first">Chaîne de caractères et streams</p>
<p>Utilisez l’API des Streams pour compter le nombre de lettres dans une chaîne
de caractères.</p>
<div class="admonition tip">
<p class="first admonition-title">Astuce</p>
<ul class="last simple">
<li>La méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#chars--">chars</a> permet d’obtenir un stream de caractères depuis un objet
de type <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html">String</a>.</li>
<li>La méthode <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Character.html#isAlphabetic-int-">Character.isAlphabetic</a> retourne <strong>true</strong> si le caractère passé
en paramètre est une lettre.</li>
</ul>
</div>
</div>
<div class="exercice topic">
<p class="topic-title first">Lecture d’un fichier CSV</p>
<p>Ètant donné un fichier CSV contenant une liste de produits. Pour chaque
ligne, on a le nom du produit, le montant HT du produit et la taxe en
pourcentage pour ce produit :</p>
<blockquote>
<div><div class="line-block">
<div class="line">produit1;12.3;20</div>
<div class="line">produit2;5.3;5.5</div>
<div class="line">produit4;123.23;20</div>
</div>
</div></blockquote>
<p>En utilisant les streams, ecrivez deux programmes :</p>
<ul class="simple">
<li>Le premier programme doit retourner le prix TTC moyen de tous les produits</li>
<li>Le second programme doit afficher la liste des produits taxés à 5,5% et qui
coûtent moins de 100€ HT.</li>
</ul>
<div class="admonition tip">
<p class="first admonition-title">Astuce</p>
<p class="last">Vous pouvez créer une classe <em>Produit</em> pour représenter en interne chacun
des produits.</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Le langage Java</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="compilation.html">Compilation &amp; exécution</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure_fondamentale.html">La structure fondamentale du langage</a></li>
<li class="toctree-l1"><a class="reference internal" href="premiere_classe.html">Une première classe</a></li>
<li class="toctree-l1"><a class="reference internal" href="types_primitifs.html">Les types primitifs</a></li>
<li class="toctree-l1"><a class="reference internal" href="operateurs.html">Les opérateurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="structures_de_controle.html">Les structures de contrôle</a></li>
<li class="toctree-l1"><a class="reference internal" href="tableau.html">Les tableaux</a></li>
<li class="toctree-l1"><a class="reference internal" href="attributs_et_methodes.html">Attributs &amp; méthodes</a></li>
<li class="toctree-l1"><a class="reference internal" href="cycle_de_vie.html">Cycle de vie d’un objet</a></li>
<li class="toctree-l1"><a class="reference internal" href="package.html">Les packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="relations_entre_objets.html">Les relations entre objets</a></li>
<li class="toctree-l1"><a class="reference internal" href="polymorphisme.html">Le polymorphisme</a></li>
<li class="toctree-l1"><a class="reference internal" href="la_classe_object.html">La classe Object</a></li>
<li class="toctree-l1"><a class="reference internal" href="la_classe_string.html">La classe String</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_exceptions.html">Les exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="classe_abstraite.html">Les classes abstraites</a></li>
<li class="toctree-l1"><a class="reference internal" href="enumeration.html">Les énumérations</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_dates.html">Les dates</a></li>
<li class="toctree-l1"><a class="reference internal" href="interface.html">Les interfaces</a></li>
<li class="toctree-l1"><a class="reference internal" href="generiques.html">Méthodes et classes génériques</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_collections.html">Les collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="entrees_sorties.html">Les entrées/sorties</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_lambdas.html">Les lambdas</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Streams</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#creation-d-un-stream">Création d’un stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-reduction">La réduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#la-collecte">La collecte</a></li>
<li class="toctree-l2"><a class="reference internal" href="#le-filtrage">Le filtrage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#le-mapping">Le mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="#le-parallelisme">Le parallélisme</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exercice">Exercice</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="classe_interne.html">Les classes internes</a></li>
<li class="toctree-l1"><a class="reference internal" href="les_annotations.html">Les annotations</a></li>
<li class="toctree-l1"><a class="reference internal" href="jdbc.html">Accès aux bases de données : JDBC</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/">Documentation Java</a></li>
    
    <li class="toctree-l1"><a href="http://docs.oracle.com/javase/8/docs/api/index.html?overview-summary.html">API Java</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;
<a ref="author" href="mailto:david.gayerie.epsi@mailoo.org">David Gayerie</a>
<a rel="license" href="https://creativecommons.org/licenses/by-sa/3.0/fr/"><img alt="Licence Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/3.0/fr/80x15.png" /></a>
.
      
    </div>

    

    
  </body>
</html>